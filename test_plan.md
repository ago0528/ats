# AX 프롬프트 테스트 계획

## 목표

1. **프롬프트 개선**: 프롬프트 길이 감소, 처리 속도 향상, 정확도 유지(최소)
2. **검증 방식 마련**: Agent별 단일 검증 시스템 구축

## 현재 상태

- 모델: `gpt-5-mini`
- 파라미터: `verbosity: low`, `reasoning-effort: low` (속도 최적화)
- 프롬프트 조회/수정 API: 구현 완료 ✅
- Worker 테스트 API: 구현 완료 ✅

## 테스트 대상 Worker

### 우선순위 1 (즉시 테스트)
- **ResumeWorker**: 지원자 관리 AI 에이전트
  - 검증 포인트: Input에 대해 적절한 도구를 호출하는가?
  - 출력: 필터가 적용된 지원자 관리 페이지 URL

### 우선순위 2 (프롬프트 개선 후)
- **OrchestratorWorker**: 하위 에이전트 실행 판단 AI 에이전트
  - 검증 포인트: 사용자 Input에 대해 적절한 Worker를 선택하는가?
  - 출력: 선택된 Worker 타입

- **ScenarioWorker**: 시나리오(Scenario) AI 에이전트
  - 검증 포인트: Input에 대해 적절한 Scenario를 뽑아내는가?
  - 출력: 선택된 시나리오

- **ScenarioScriptWorker**: 대본(Scenario Script) 진행 AI 에이전트
  - 검증 포인트: 시나리오 대본에 따라 올바르게 데이터 수집하는가?
  - 출력: 결과 URL

## 테스트 단계

### Phase 1: 프롬프트 분석 및 벤치마크 수립 (1-2일)

#### 1.1 현재 프롬프트 조회 및 분석
- [ ] 각 Worker별 프롬프트 조회
- [ ] 프롬프트 길이 측정
- [ ] 프롬프트 구조 분석 (불필요한 설명, 중복 내용 등)
- [ ] 프롬프트 최적화 포인트 도출

#### 1.2 베이스라인 성능 측정
- [ ] 각 Worker별 샘플 Input 준비 (최소 5-10개)
- [ ] 현재 프롬프트로 테스트 실행
- [ ] 성능 지표 수집:
  - 응답 시간 (초)
  - 토큰 사용량
  - 정확도 (예상 출력과 실제 출력 비교)

**도구**: Streamlit 앱의 Worker 테스트 기능 활용

### Phase 2: 프롬프트 개선 (2-3일)

#### 2.1 프롬프트 최적화 전략
- **길이 감소 방법**:
  - 불필요한 예시 제거
  - 중복 설명 통합
  - 핵심 지시사항만 유지
  - 구조화된 형식으로 변경 (JSON, 마크다운 등)

- **속도 향상 방법**:
  - 명확한 출력 형식 지정
  - 단계별 처리 지시 최소화
  - 조건문 간소화

- **정확도 유지 방법**:
  - 핵심 역할 정의 유지
  - 필수 제약사항 명시
  - 예외 처리 가이드라인 포함

#### 2.2 프롬프트 개선 및 테스트
- [ ] Worker별로 프롬프트 개선안 작성
- [ ] Streamlit 앱에서 프롬프트 수정
- [ ] 개선된 프롬프트로 동일한 샘플 테스트
- [ ] 성능 비교:
  - 길이: X자 → Y자 (Z% 감소)
  - 속도: X초 → Y초 (Z% 향상)
  - 정확도: X% → Y% (유지/향상)

### Phase 3: 검증 시스템 구축 (3-4일)

#### 3.1 검증 프레임워크 설계

**구조**:
```
src/ats/ax/validation/
├── __init__.py
├── base_validator.py          # 기본 검증 클래스
├── resume_worker_validator.py # ResumeWorker 전용 검증
├── orchestrator_validator.py  # OrchestratorWorker 전용 검증
├── scenario_worker_validator.py
├── test_runner.py             # Bulk 테스트 실행기
├── test_data/                 # 테스트 데이터셋
│   ├── resume_worker_test_cases.json
│   ├── orchestrator_test_cases.json
│   ├── scenario_test_cases.json
│   └── tools_dataset.json     # 툴 데이터셋
└── results/                   # 테스트 결과 저장
```

#### 3.2 검증 방식 정의

**ResumeWorker 검증**:
- Input: 사용자 질문 (예: "3년 이상 경력의 백엔드 개발자 찾아줘")
- Expected Output: 
  - 적절한 도구 호출 여부
  - 생성된 URL 형식 검증
  - 필터 파라미터 정확성
- 검증 메트릭:
  - 도구 선택 정확도
  - URL 생성 정확도
  - 응답 시간

**OrchestratorWorker 검증**:
- Input: 사용자 질문
- Expected Output: 선택된 Worker 타입
- 검증 메트릭:
  - Worker 선택 정확도
  - 응답 시간

**ScenarioWorker 검증**:
- Input: 사용자 질문
- Expected Output: 선택된 시나리오 ID/이름
- 검증 메트릭:
  - 시나리오 선택 정확도
  - 응답 시간

#### 3.3 테스트 데이터셋 준비

**필요한 데이터셋**:
1. **시나리오 데이터셋** (ScenarioWorker용)
   - 시나리오 목록
   - 각 시나리오의 설명
   - 시나리오별 예상 사용 케이스

2. **툴 데이터셋** (ResumeWorker용)
   - 사용 가능한 도구 목록
   - 각 도구의 설명 및 파라미터
   - 도구별 사용 예시

3. **테스트 케이스** (각 Worker별)
   - 다양한 Input 시나리오
   - Expected Output
   - Edge cases

### Phase 4: Bulk 테스트 실행 및 분석 (1-2일)

#### 4.1 자동화된 테스트 실행
- [ ] Python Script로 Bulk 테스트 실행
- [ ] 결과 자동 수집 및 저장
- [ ] 성능 리포트 생성

#### 4.2 결과 분석
- [ ] 성능 지표 비교 (Before/After)
- [ ] 정확도 분석
- [ ] 실패 케이스 분석
- [ ] 개선 포인트 도출

## 검증 메트릭 정의

### 성능 메트릭
- **응답 시간**: API 호출부터 응답 받기까지의 시간 (초)
- **토큰 사용량**: Input/Output 토큰 수
- **처리량**: 초당 처리 가능한 요청 수

### 정확도 메트릭
- **도구 선택 정확도**: ResumeWorker의 경우 적절한 도구 선택 비율
- **Worker 선택 정확도**: OrchestratorWorker의 경우 적절한 Worker 선택 비율
- **시나리오 선택 정확도**: ScenarioWorker의 경우 적절한 시나리오 선택 비율
- **출력 형식 정확도**: 예상 형식과 일치하는 비율

### 품질 메트릭
- **프롬프트 길이**: 문자 수
- **프롬프트 복잡도**: 구조적 복잡도 점수
- **에러율**: 실패한 요청 비율

## 예상 일정

| Phase | 작업 | 예상 소요 시간 |
|-------|------|---------------|
| Phase 1 | 프롬프트 분석 및 벤치마크 | 1-2일 |
| Phase 2 | 프롬프트 개선 | 2-3일 |
| Phase 3 | 검증 시스템 구축 | 3-4일 |
| Phase 4 | Bulk 테스트 및 분석 | 1-2일 |
| **총계** | | **7-11일** |

## 다음 단계

1. **즉시 시작 가능한 작업**:
   - [ ] Streamlit 앱으로 각 Worker 프롬프트 조회
   - [ ] 프롬프트 길이 및 구조 분석
   - [ ] 샘플 테스트 케이스 작성

2. **백엔드팀 협업 필요**:
   - [ ] 시나리오 데이터셋 요청
   - [ ] 툴 데이터셋 요청
   - [ ] ResumeWorker API 테스트 가능 여부 확인

3. **검증 시스템 개발**:
   - [ ] 검증 프레임워크 구조 설계
   - [ ] ResumeWorker 검증 로직 구현 (우선)
   - [ ] Bulk 테스트 스크립트 개발

## 참고사항

- 현재 모델이 `gpt-5-mini`이고 속도 최적화 파라미터를 사용 중이므로, 프롬프트 최적화가 속도에 큰 영향을 줄 수 있음
- 에이전틱 시스템 특성상 구조 변경과 UI/UX 개선도 함께 고려해야 함
- 검증 시스템은 반복적인 프롬프트 개선 작업에 재사용 가능하도록 설계해야 함



